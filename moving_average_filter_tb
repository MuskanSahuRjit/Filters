`timescale 1ns / 1ps

module moving_average_filter_tb;

    // Parameters
    parameter N = 201;
    parameter DATA_WIDTH = 16;
    parameter CLK_PERIOD = 4000; // 250 Hz sampling = 4ms period = 4000ns

    // Inputs to the filter
    reg clk;
    reg reset;
    reg signed [DATA_WIDTH-1:0] sample_in;

    // Output from the filter
    wire signed [DATA_WIDTH-1:0] avg_out;

    // Instantiate the DUT
    moving_average_filter #(
        .N(N),
        .DATA_WIDTH(DATA_WIDTH)
    ) dut (
        .clk(clk),
        .reset(reset),
        .sample_in(sample_in),
        .avg_out(avg_out)
    );

    // Clock Generation
    initial clk = 0;
    always #(CLK_PERIOD/2) clk = ~clk;

    // Test data
    integer i;
    real t;
    initial begin
        $display("Starting Moving Average Filter Testbench...");
        reset = 1;
        sample_in = 0;
        #10000;
        reset = 0;

        for (i = 0; i < 2000; i = i + 1) begin
            t = i * 1.0 / 250; // time in seconds at 250 Hz

            // Generate ECG-like signal with baseline wander
            // Main ECG: 1.5Hz sine + baseline: 0.2Hz sine
            sample_in = $rtoi(5000 * $sin(2 * 3.1416 * 1.5 * t) + 
                              2000 * $sin(2 * 3.1416 * 0.2 * t));
            #(CLK_PERIOD);
        end

        $finish;
    end

endmodule
